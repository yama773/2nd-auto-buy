<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2nd STREET è‡ªå‹•è³¼å…¥ãƒ„ãƒ¼ãƒ«</title>
  <style>body{font-family:sans-serif;padding:16px}</style>
</head>
<body>
  <h2>2nd STREET è‡ªå‹•è³¼å…¥ãƒ„ãƒ¼ãƒ«</h2>
  <p id="state">åˆæœŸåŒ–ä¸­â€¦</p>

  <script>
  (async ()=>{
    const sleep=t=>new Promise(r=>setTimeout(r,t));
    const log=msg=>document.getElementById('state').textContent=msg;
    const q=new URLSearchParams(location.search);
    const target=q.get('target');
    if(!target){log('âŒ targetãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');return;}

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š */
    const GEO_ID='09089145579';
    const GEO_PW ='s2518190';
    const BIRTH={y:'1980',m:'01',d:'25'};
    const JOB='4'; // è‡ªå–¶æ¥­

    /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã */
    const popup=window.open(target,'_blank','width=480,height=780');
    if(!popup){log('âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„');return;}

    /* è¦ç´ å¾…æ©Ÿé–¢æ•° */
    const wfe=(doc,sel,limit=40)=>new Promise((res,rej)=>{let c=0;const i=setInterval(()=>{try{const el=doc.querySelector(sel);if(el){clearInterval(i);res(el);}else if(++c>limit){clearInterval(i);rej('è¦ç´ ãªã—:'+sel);}}catch(e){}},250);});
    const click=el=>el&&el.dispatchEvent(new Event('click',{bubbles:true,cancelable:true,view:popup}));
    const touchClick=el=>{['touchstart','touchend','click'].forEach(ev=>el.dispatchEvent(new Event(ev,{bubbles:true,cancelable:true,view:popup})))};

    const main=async()=>{
      try{
        /* å•†å“ãƒšãƒ¼ã‚¸ï¼šã‚«ãƒ¼ãƒˆã‚¤ãƒ³ */
        log('ğŸ›’ ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³å¾…ã¡');
        const cartBtn=await wfe(popup.document,'#addCartBtn');
        touchClick(cartBtn);
        if(typeof popup.cartRegist==='function')popup.cartRegist(1);
        await wfe(popup.document,'#addedCart');
        log('ğŸ›’ ã‚«ãƒ¼ãƒˆè¿½åŠ æˆåŠŸ â†’ ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸');
        await sleep(1200);
        popup.location.href='/cart';

        /* ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ï¼šãƒ¬ã‚¸ã«é€²ã‚€ */
        log('ğŸ’³ ãƒ¬ã‚¸ã«é€²ã‚€ãƒœã‚¿ãƒ³å¾…ã¡');
        const regibtn=await wfe(popup.document,'button.cartBtn[form="cart_information_detail"]');
        click(regibtn);
        await sleep(2500);

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãƒã‚§ãƒƒã‚¯ */
        if(popup.document.querySelector('#authId')){
          log('ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ - è‡ªå‹•å…¥åŠ›');
          popup.document.querySelector('#authId').value=GEO_ID;
          popup.document.querySelector('input[name="password"]').value=GEO_PW;
          alert('GEO ID ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã—ãŸã€‚reCAPTCHA ã‚’æ‰‹å‹•ã§å®Œäº†ã—ã¦ãã ã•ã„ã€‚å®Œäº†å¾Œãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ãšã«å¾…ã¦ã°å‡¦ç†ãŒå†é–‹ã—ã¾ã™ã€‚');
          return;
        }

        /* å¤ç‰©æƒ…å ±å…¥åŠ› */
        log('ğŸ“… ç”Ÿå¹´æœˆæ—¥ãƒ»è·æ¥­å…¥åŠ›');
        popup.document.querySelector('select[name="birthdayYear"]').value=BIRTH.y;
        popup.document.querySelector('select[name="birthdayMonth"]').value=BIRTH.m;
        popup.document.querySelector('select[name="birthdayDay"]').value=BIRTH.d;
        popup.document.querySelector('select[name="jobCode"]').value=JOB;
        await sleep(500);

        /* æœ€çµ‚ç¢ºèªã¸ */
        const confirmBtn=popup.document.querySelector('#submit-btn');
        if(confirmBtn)click(confirmBtn);
        await sleep(1500);

        /* æ³¨æ–‡ç¢ºå®š */
        const orderBtn=popup.document.querySelector('#order_submit');
        if(orderBtn){click(orderBtn);log('âœ… æ³¨æ–‡ç¢ºå®šã‚¯ãƒªãƒƒã‚¯');}
        else{log('âš ï¸ æ³¨æ–‡ç¢ºå®šãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');}
      }catch(e){log('âš ï¸ '+e);} }

    /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— load å®Œäº†ã‚’å¾…ã£ã¦ main å®Ÿè¡Œ */
    const timer=setInterval(()=>{try{if(popup.document&&popup.document.readyState==='complete'){clearInterval(timer);main();}}catch(e){}},300);
  })();
  </script>
</body>
</html>
