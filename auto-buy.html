<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2nd STREET è‡ªå‹•è³¼å…¥ãƒ„ãƒ¼ãƒ«</title>
  <style>body{font-family:sans-serif;padding:16px}</style>
</head>
<body>
  <h2>2ndÂ STREETÂ è‡ªå‹•è³¼å…¥ãƒ„ãƒ¼ãƒ«</h2>
  <p id="state">åˆæœŸåŒ–ä¸­â€¦</p>

  <script>
  (async ()=>{
    const sleep=t=>new Promise(r=>setTimeout(r,t));
    const log=(msg)=>document.getElementById('state').textContent=msg;
    const params=new URLSearchParams(location.search);
    const target=params.get('target');
    if(!target){log('âŒ targetãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');return;}

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ ã“ã‚Œä»¥é™ã€å‡¦ç†ã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è‡ªèº«ã§è¡Œã† â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const popup=window.open(target,'_blank','width=480,height=780');
    if(!popup){log('âŒ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„');return;}

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š */
    const GEO_ID='09089145579';
    const GEO_PW ='s2518190';
    const BIRTH={y:'1980',m:'01',d:'25'};
    const JOB_CODE='4';

    /* å…±é€šé–¢æ•° */
    const wfe=(doc,sel,limit=40)=>new Promise((res,rej)=>{let c=0;const i=setInterval(()=>{const el=doc.querySelector(sel);if(el){clearInterval(i);res(el);}else if(++c>limit){clearInterval(i);rej('è¦ç´ ãªã—:'+sel);} },250);});

    const click=(el)=>{if(!el)return false;el.dispatchEvent(new MouseEvent('click',{bubbles:true,cancelable:true,view:popup}));return true;};

    /* ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— */
    const main=async()=>{
      try{ log('ğŸ“„ å•†å“ãƒšãƒ¼ã‚¸å¾…æ©Ÿ');
        await wfe(popup.document,'#addCartBtn');
        log('ğŸ›’ ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã‚¯ãƒªãƒƒã‚¯');
        const btn=popup.document.querySelector('#addCartBtn');
        if(!click(btn))throw 'clickå¤±æ•—';
        /* cartRegist ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆä¿é™ºï¼‰*/
        if(typeof popup.cartRegist==='function')popup.cartRegist(1);
        await sleep(1500);
        log('ğŸšš ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸');
        popup.location.href='/cart';

        /* ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã§ã€Œãƒ¬ã‚¸ã«é€²ã‚€ã€ */
        await wfe(popup.document,'button.cartBtn[form="cart_information_detail"]');
        click(popup.document.querySelector('button.cartBtn[form="cart_information_detail"]'));
        log('ğŸ’³ ãƒ¬ã‚¸ã«é€²ã‚€ã‚¯ãƒªãƒƒã‚¯');
        await sleep(2500);

        /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‹åˆ¤å®š */
        if(popup.document.querySelector('#authId')){
          log('ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢æ¤œå‡º â€“ è‡ªå‹•å…¥åŠ›');
          popup.document.querySelector('#authId').value=GEO_ID;
          popup.document.querySelector('input[name="password"]').value=GEO_PW;
          alert('GEOÂ ID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã—ãŸã€‚reCAPTCHAã‚’æ‰‹å‹•ã§å®Œäº†ã—ã¦ãã ã•ã„ã€‚å®Œäº†å¾Œã€è‡ªå‹•å‡¦ç†ãŒç¶šè¡Œã•ã‚Œã¾ã™ã€‚');
          return; // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾…ã¡
        }

        /* ç”Ÿå¹´æœˆæ—¥ & è·æ¥­å…¥åŠ› (å¤ç‰©æ³•) */
        const ySel=popup.document.querySelector('select[name="birthdayYear"]');
        if(ySel){ ySel.value=BIRTH.y; popup.document.querySelector('select[name="birthdayMonth"]').value=BIRTH.m; popup.document.querySelector('select[name="birthdayDay"]').value=BIRTH.d; popup.document.querySelector('select[name="jobCode"]').value=JOB_CODE; log('ğŸ“… ç”Ÿå¹´æœˆæ—¥ãƒ»è·æ¥­å…¥åŠ›'); await sleep(500);}        

        /* æœ€çµ‚ç¢ºèªã¸ */
        if(click(popup.document.querySelector('#submit-btn'))){ log('â¡ï¸ æœ€çµ‚ç¢ºèªã¸'); await sleep(1500);}        
        /* æ³¨æ–‡ç¢ºå®š */
        if(click(popup.document.querySelector('#order_submit'))){ log('âœ… æ³¨æ–‡ç¢ºå®šã‚¯ãƒªãƒƒã‚¯å®Œäº†'); }
      }catch(e){log('âš ï¸ ã‚¨ãƒ©ãƒ¼:'+e);console.error(e);} }

    /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ç›£è¦–ã—ã¦ main å®Ÿè¡Œ */
    const onReady=()=>{ if(popup.document.readyState==='complete'){main();}else{popup.document.addEventListener('readystatechange',()=>{if(popup.document.readyState==='complete')main();});}}
    const timer=setInterval(()=>{ if(popup.document){clearInterval(timer);onReady();}},300);
  })();
  </script>
</body>
</html>
