<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>2nd STREET Auto Buyer</title>
</head>
<body>
  <h3>2nd STREET è‡ªå‹•è³¼å…¥ãƒ„ãƒ¼ãƒ«</h3>
  <p>å‡¦ç†ä¸­â€¦ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã‹ã‚Œã€è³¼å…¥å‡¦ç†ãŒé€²è¡Œã—ã¾ã™ã€‚</p>

  <script>
    const delay = ms => new Promise(res => setTimeout(res, ms));

    const params = new URLSearchParams(location.search);
    const target = params.get("target");

    if (!target) {
      document.body.innerHTML += '<p style="color:red">âŒ ã‚¨ãƒ©ãƒ¼ï¼štargetãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
      throw new Error("No target specified");
    }

    // å•†å“ãƒšãƒ¼ã‚¸ã§ãªã‘ã‚Œã°ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹
    if (!location.href.includes("goodsId")) {
      location.href = target;
    } else {
      // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰å‡¦ç†é–‹å§‹
      window.onload = async () => {
        console.log("âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†");

        try {
          // ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰ã‚’å¾…ã¤
          for (let i = 0; i < 20; i++) {
            const btn = document.querySelector("#addCartBtn");
            if (btn) {
              btn.click();
              console.log("ğŸ›’ ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã‚¯ãƒªãƒƒã‚¯æˆåŠŸ");
              await delay(2000);
              location.href = "/cart";
              return;
            }
            await delay(500);
          }

          alert("âŒ ã‚«ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
        } catch (e) {
          alert("âŒ ã‚«ãƒ¼ãƒˆè¿½åŠ ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
          console.error(e);
        }
      };
    }
  </script>
</body>
</html>
